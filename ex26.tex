\chapter{Exercise 26: Write A First Real Program}

You are at the half-way mark in the book, so you need to take a 
mid-term.  In this mid-term you're going to recreate a piece
of software I wrote specifically for this book called \program{devpkg}.
You'll then extend it in a few key ways and improve the code, most
importantly by writing some unit tests for it.

\section{What Is \program{devpkg}?}

\program{Devpkg} is a simple C program that installs other software.  I
made it specifically for this book as a way to teach you how a real 
software project is structured, and also how to reuse other people's
libraries.  It uses a portability library called \href{http://apr.apache.org/}{The
Apache Portable Runtime (APR)} that has many handy C functions which
work on tons of platforms, including Windows.

\begin{aside}{Do Not Cheat}
The source code to \program{devpkg} is already online in a repository
I created, so you could be a loser and just check it out.  I put it up
because it is actually useful for you to go check your work against
mine and see what mistakes you've made.  \emph{However}, resist the
urge to do this until you are truly stuck.
\end{aside}

\subsection{What We Want To Make}

We want a tool that has three commands:

\begin{enumerate}
\item[devpkg -S] Sets up a new install on a computer.
\item[devpkg -I] Installs a piece of software from a URL.
\item[devpkg -L] Lists all the software that's been installed.
\end{enumerate}

We want \program{devpkg} to be able to take almost any URL, figure
out what kind of project it is, download it, install it, and register
that it downloaded that software.  We'd also like it to process a
simple dependency list so it can install all the software that a
project might need as well.

\subsection{The Design}

To accomplish this goal \program{devpkg} will have a very simple design:

\begin{description}
\item[Use external commands] You'll do most of the work through external
    commands like \program{curl}, \program{git}, and \program{tar}.  This
    reduces the amount of code \program{devpkg} needs to get things done.
\item[Simple File Database] You could easily make it more complex, but to
    start you'll just make a single simple file database at
    \file{/usr/local/.devpkg/db} to keep track of what's installed.
\item[/usr/local Always] Again you could make this more advanced, but for
    starters just assume it's always \file{/usr/local} which is a standard
    install path for most software on Unix.
\item[configure, make, make install] It's assumed that most software can
    install with just a \program{configure; make; make install} and maybe
    \program{configure} is optional.  If the software can't at a minimum
    do that, then there's some options ot modify the commands, but otherwise
    \program{devpkg} won't bother.
\item[The User Can Be root] We'll assume the user can become root using
    sudo, but that they don't want to become root until the end.
\end{description}

This will keep our program small at first and work well enough to get it
going, at which point you'll be able to modify it further for this exercise.


\subsection{The Apache Portable Runtime}

One more thing you'll do is leverage the \href{http://apr.apache.org/}{The
Apache Portable Runtime (APR)} libraries to get a good set of portable routines
for doing this kind of work.  The APR isn't necessary, and you could probably
write this program without them, but it'd take more code than necessary.
I'm also forcing you to use APR now so you get used to linking and using
other libraries.  Finally, the APR also works on \emph{Windows} so your
skills with it are transferable to many other platforms.

You should go get both the \library{apr-1.4.5} and the \library{apr-util-1.3}
libraries, as well as browse through the documentation available at the 
\href{http://apr.apache.org/}{main APR site at apr.apache.org}.

Here's a shell script that will install all the stuff you need.  You
should write this into a file by hand, and then run it until it can
install APR without any errors.

\begin{code}{APR Install Script}
<< d['code/ex26.1.sh|pyg|l'] >>
\end{code}

I'm having you write this script out because this is basically what
we want \program{devpkg} to do, but with extra options and checks.
In fact, you could just do it all in shell with less code, but then
that wouldn't be a very good program for a C book would it?

Simply run this script and fix it until it works, then you'll have the
libraries you need to complete the rest of this project.


\section{Project Layout}

Coming soon.

\section{The Source Files}

Coming soon.


\section{The Mid-Term Exam}

Coming soon.

